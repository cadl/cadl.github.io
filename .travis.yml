language: ruby
cache: bundler
rvm:
- 2.6.3
addons:
  apt:
    packages:
    - openjdk-8-jre
before_install:
- gem update --system
- gem install bundler
- nvm install node
install:
- bundle install --jobs=3 --retry=3
- pip install --user html5validator
- npm install -g pa11y-ci
script:
- bundle exec jekyll clean && bundle exec jekyll build
# - html5validator --Werror --also-check-css --also-check-svg --root _site/
- |
  (bundle exec jekyll server -d _tmp_site & echo $! >&3) 3>jekyll.pid | grep -q 'Server running' && \
  pa11y-ci --sitemap http://localhost:4000/whiteglass/sitemap.xml && \
  kill -9 "$(cat jekyll.pid)" && \
  rm -f jekyll.pid
branches:
  only:
  - src
deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  keep-history: true
  local-dir: _site
  target-branch: master
  on:
    branch: src
env:
  global:
    secure: VGHOKWwz9YjaTBSpjTaEaTH44xEqXMR16m1mAHH82Wt3UiLMY5X4txpbEFKn7Ky6u2NkyexQ2QKpqvP7rClXV6aJIBHVCJr/gi7JxMBgu+CDX8dYzkKmawgVul0IKJFFSSOj2W/0kjXCp8ojrwN1bPCDVowQD++flXhaN38LMJjQ5a+/YcLgcD+pBKIc/8C/wGlSetEg51cIj1o7MHEijOw+J9U9yN+n3U6h5gKqHlt4XAt+2LnhQP9UeP7GJxweOEmZWXdazBzQtdFiDzL21VmOYf7kp8wlCT2bKpL9d0s4vrqn4q8LjlLSlnT7CWXKCrZo8d1LOBdRNOQBb99eo9AnwdN8qW6H3wMVMNvs3TMrjJzRDseJxA5SiaAHGwl+/AT6iYPxnkUh4UwTxIaq8rE4slDFfo8jlq0oYpBTALCmuEgsWBW874o3jdf1at7KAJ3pzVidfOsswdr0pMENESk7T/akHq8uU7TIZzOM4oRdNR/3ftbNJK99xE3McuUWSKL8jfof9ToDRsvZfSvwB9vVA1u61Y1+pM58QdilFhgDLg3KeSlsdnO/hu6nZDqW8oVErYQHucwSVqqqXg/CMM/askWUS3/cZmSD/l6I5POWoeWEuENF/LF0StN7U2gB3FCEKaBHrH/PbFYBfp0hg53tet8I2HLKh6JZMp+u/oE=
