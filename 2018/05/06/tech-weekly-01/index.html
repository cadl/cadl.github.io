<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>tech weekly 第 01 期</title>
  <meta name="description" content="大家好，这里是 tech weekly 第 01 期。">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://cadl.github.io/2018/05/06/tech-weekly-01/">
  
  
  <link rel="alternate" type="application/rss+xml" title="三月兔亭" href="https://cadl.github.io/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="ctrlaltdeletel">
  <meta name="twitter:title" content="tech weekly 第 01 期">
  <meta name="twitter:description" content="大家好，这里是 tech weekly 第 01 期。">
  
    <meta name="twitter:creator" content="ctrlaltdeletel">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-53244426-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53244426-1');
</script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">三月兔亭</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="https://github.com/cadl">GitHub</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">tech weekly 第 01 期</h1>
    
    <p class="post-meta"><time datetime="2018-05-06T14:28:00+00:00" itemprop="datePublished">May 6, 2018</time> •
  
    
    
      
    
      
    
      
        <a href="/categories/tech-weekly/">tech-weekly</a>
      
    
      
    
  



</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>大家好，这里是 tech weekly 第 01 期。</p>

<h1 id="新闻">新闻</h1>

<h3 id="gvisor"><a href="https://github.com/google/gvisor">gvisor</a></h3>

<p>google 开源了一个叫作 <a href="https://github.com/google/gvisor">gvisor</a>的项目。旨在提供一个沙盒化的 container runtime，由 go 语言实现。兼容 <a href="https://www.opencontainers.org/">OCI</a> 标准，可以与 docker 等工具集成使用。</p>

<p>看了一下项目的 readme，貌似是通过 ptrace hook 掉系统调用，替换为用户态的实现，来达到沙盒的目的。看到 ptrace，第一反应就是以后借助 gvisor，实现 online judge 程序会变得简单很多。</p>

<h3 id="twitter-keeping-your-account-secure"><a href="https://blog.twitter.com/official/en_us/topics/company/2018/keeping-your-account-secure.html">twitter: Keeping your account secure</a></h3>

<p>twitter 近日发布<a href="https://blog.twitter.com/official/en_us/topics/company/2018/keeping-your-account-secure.html">公告</a>，提醒用户修改密码以提高帐号的安全性。原因是 twitter 发现自己的程序在某个日志中记录了明文密码。此类问题应该如何避免，一些日志的框架/库比如 python 的 logging 模块或者 java log4j 等等都有提供 filter 的功能。可以借助 filter，制定一些规则来过滤敏感信息。但远没有这么简单，除了日志，任何发生数据流动的环节都可能会出现类似的问题。</p>

<h1 id="文章">文章</h1>

<h3 id="writing-testable-code"><a href="https://testing.googleblog.com/2008/08/by-miko-hevery-so-you-decided-to.html">writing testable code</a></h3>

<p>一篇很老的文章，出自 google 测试团队博客。一直感觉写出便于测试的代码是一件特别困难的事情，首先做到的基本前提就是模块边界、依赖处理清晰，接口设计合理。</p>

<p>文中罗列了 writing testable code 需要注意的一些点。比如不要将 object 的构造和逻辑混合、如何处理依赖(“Ask for things, Don’t look for things”)、谨慎全局变量/单例/静态方法、区分 value object 等等。</p>

<p>各种啰嗦的 factory 以及依赖注入是有存在道理的。联系到之前 CPyUG 里关于依赖注入的<a href="https://groups.google.com/forum/?hl=fil#!topic/python-cn/gup7mNgOniA">讨论</a>，在动态语言上应用依赖注入的分歧还很大，貌似也没有太好的实践。然而春天已经快过去了，我还没有学习 spring……</p>

<h3 id="understanding-actor-concurrency-part-1-actors-in-erlang"><a href="https://www.javaworld.com/article/2077999/java-concurrency/understanding-actor-concurrency--part-1--actors-in-erlang.html">Understanding actor concurrency, Part 1: Actors in Erlang</a></h3>

<p>也是一篇很老的文章，通过 erlang 几个 tutorial 般的操作，简单介绍了 actor 模型。从消息传递的角度看，actor 和 OO 的关系就很暧昧了。或者说 OO 的概念本来就很暧昧。</p>

<h3 id="apache-kafka-best-practices"><a href="https://www.slideshare.net/HadoopSummit/apache-kafka-best-practices">Apache kafka best practices</a></h3>

<p>一个关于 kafka 实践的 slide。有一些关于硬件配置，系统调优，replication，参数配置等内容。</p>

<h3 id="知乎-feed-流架构演进"><a href="http://www.infoq.com/cn/presentations/architecture-evolution-of-zhihu-feed-flow">知乎 feed 流架构演进</a></h3>

<p>知乎借助 redis module 对 feed 流进行改进的演讲视频。为了解决从 feed 数据源拉取数据后进行过滤聚合等操作导致的拉取数量不确定、奇怪缓存逻辑、实时性差、网络开销等问题，将计算逻辑下沉封装到 redis module 中。</p>

<p>也介绍了其中碰到的一些问题：redis module 存在的坑、redis 单线程带来的 cpu 瓶颈等。</p>

<h1 id="关于服务容错">关于服务容错</h1>

<h3 id="circuitbreaker"><a href="http://martinfowler.com/bliki/CircuitBreaker.html">CircuitBreaker</a></h3>

<p>Martin Fowler 关于 circuit breaker 的一篇介绍性文章。</p>

<h3 id="美团-服务容错模式"><a href="https://tech.meituan.com/service-fault-tolerant-pattern.html">美团-服务容错模式</a></h3>

<p>几种常见模式以及 hystrix 的介绍。</p>

<h3 id="how-hystrix-works"><a href="https://github.com/Netflix/Hystrix/wiki/How-it-Works">how hystrix works</a></h3>

<p>hystrix 是 netflix 开源的一个处理延迟和服务容错的库。wiki 里画的工作流程图还比较清晰。</p>

<h3 id="failsafe"><a href="https://github.com/jhalterman/failsafe">Failsafe</a></h3>

<p>Failsafe 是一个相比 hystrix 轻量一些的库，api 也更清爽些。比较 hystrix，failsafe 增加了重试功能，更多区别见<a href="https://github.com/jhalterman/failsafe/wiki/Comparisons">Failsafe vs Hystrix</a>。failsafe 的<a href="https://github.com/jhalterman/failsafe/wiki/Who's-Using-Failsafe">用户列表</a></p>

<h1 id="碰到的一些坑">碰到的一些坑</h1>

<h3 id="kafka-connect-hdfs-无法与-regexrouter-smt-配合使用">kafka-connect-hdfs 无法与 RegexRouter SMT 配合使用</h3>

<p><a href="https://www.confluent.io/product/connectors/">kafka connect</a> 是方便连通其他系统数据的一个 kafka 组件。集成 source/sink connector 插件，可以从其他系统中导入数据至 kafka，也可从 kafka 导出数据到其他系统。</p>

<p><a href="https://docs.confluent.io/current/connect/connect-hdfs/docs/index.html">kafka-connect-hdfs</a> 是 confluent 提供的一个 sink connector，向 hdfs 导入数据，同时可以结合 hive metastore api，创建 hive 表，写入 hive 表数据至 hdfs。SMT 是 kafka-connect 的一个机制，可以以插件的形式对数据记录进行某些操作，比如增减数据字段。</p>

<p><a href="https://docs.confluent.io/current/connect/transforms/regexrouter.html">RegexRouter</a> 是 kafka-connect 内置的一个 SMT，可以对数据记录上附着的 kafka topic 名称做一些映射修改。但是，kafka-connect-hdfs 因为实现问题，无法与 RegexRouter 配合工作(抛 NPE)，导致 hive 表中的名字只能很僵硬地跟 kafka topic 名称对应。</p>

<h3 id="parquet-tools-merge-功能不合并-row-group">parquet-tools merge 功能不合并 Row Group</h3>

<p>某些场景下有大量容量很小的 parquet 文件，为了提高 Hadoop 生态的操作效率，需要对这些小文件进行合并。</p>

<p>Apache parquet-tools 提供了一个 merge 功能。使用后发现，合并操作并没合并 parquet 中的 Row Group 结构(可以理解为把文件单纯地拼接起来)。相对于原来众多小文件的形式，因为 MR 并行度降低，效率反而会降低很多。</p>

<h1 id="本周最佳音乐专辑">本周最佳音乐专辑</h1>

<h3 id="random-access-memories"><a href="https://music.douban.com/subject/22951704/">Random Access Memories</a></h3>
<p>一张名字叫 RAM 的电子专辑。</p>

<h1 id="链接">链接</h1>
<ul>
  <li><a href="https://github.com/google/gvisor">gvisor</a></li>
  <li><a href="https://blog.twitter.com/official/en_us/topics/company/2018/keeping-your-account-secure.html">twitter: Keeping your account secure</a></li>
  <li><a href="https://testing.googleblog.com/2008/08/by-miko-hevery-so-you-decided-to.html">writing testable code</a></li>
  <li><a href="https://www.javaworld.com/article/2077999/java-concurrency/understanding-actor-concurrency--part-1--actors-in-erlang.html">Understanding actor concurrency, Part 1: Actors in Erlang</a></li>
  <li><a href="https://www.slideshare.net/HadoopSummit/apache-kafka-best-practices">Apache kafka best practices</a></li>
  <li><a href="http://www.infoq.com/cn/presentations/architecture-evolution-of-zhihu-feed-flow">知乎 feed 流架构演进</a></li>
  <li><a href="http://martinfowler.com/bliki/CircuitBreaker.html">CircuitBreaker</a></li>
  <li><a href="https://tech.meituan.com/service-fault-tolerant-pattern.html">美团-服务容错模式</a></li>
  <li><a href="https://github.com/Netflix/Hystrix/wiki/How-it-Works">how hystrix works</a></li>
  <li><a href="https://github.com/jhalterman/failsafe">Failsafe</a></li>
  <li><a href="https://www.confluent.io/product/connectors/">kafka connect</a></li>
  <li><a href="https://docs.confluent.io/current/connect/connect-hdfs/docs/index.html">kafka-connect-hdfs</a></li>
  <li><a href="https://docs.confluent.io/current/connect/transforms/regexrouter.html">RegexRouter</a></li>
</ul>

  </div>

  
    <div class="post-comments" itemprop="comment">
      <hr />
<h1>Comments</h1>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://cadlblog.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
    </div>
  

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy;  - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="https://cadl.github.io/feed.xml">RSS</a>

    </p>

  </div>

</footer>


  </body>

</html>
